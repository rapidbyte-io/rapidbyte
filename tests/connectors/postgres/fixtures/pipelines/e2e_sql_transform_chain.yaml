version: "1.0"
pipeline: e2e_sql_transform_chain

source:
  use: source-postgres
  config:
    host: localhost
    port: 5433
    user: postgres
    password: postgres
    database: rapidbyte_test
  streams:
    - name: chain_test
      sync_mode: full_refresh

transforms:
  # Step 1: uppercase names and add a computed column
  - use: transform-sql
    config:
      query: "SELECT id, UPPER(name) AS name, age, age * 2 AS double_age FROM input"

  # Step 2: filter to only rows where age > 25 and drop original age
  - use: transform-sql
    config:
      query: "SELECT id, name, double_age FROM input WHERE age > 25"

destination:
  use: dest-postgres
  config:
    host: localhost
    port: 5433
    user: postgres
    password: postgres
    database: rapidbyte_test
    schema: raw_chain
  write_mode: append

state:
  backend: sqlite
  connection: /tmp/rapidbyte_e2e_sql_chain_state.db
